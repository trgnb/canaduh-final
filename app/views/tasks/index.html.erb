<%= render 'shared/navbar' %>
  <div class="main-container">
    <!-- TIMELINE -->
      <% if current_user.user_type == "user" %>
        <h1>My Journey</h1>

          <p>Percentage of completion: <%= (@percent_completion.round(1) * 100).to_i %> %</p>
            <% @milestones.each do |milestone| %>
              <ul>
                <li>
                  <%= link_to milestone.milestone_title, edit_milestone_path(milestone) %>
                  <%= milestone.milestone_date %>
                  <% milestone.achieved %>
                </li>
              </ul>
            <% end %>

            <p>DB AVERAGE WIP</p>
            <p>User' processing time: <%= @total_processing_time %></p>
            <ol>
              <li>CSQ Reception: <%= @csq_processing_time %> months</li>
              <li>PR Application Receipt Confirmation: <%= @pr1_processing_time %> months</li>
              <li>Medical Exam: <%= @pr2_processing_time %> months</li>
              <li>PR Reception: <%= @pr3_processing_time %> months</li>
              <li>PR Processing Time: <%= @total_pr_processing_time %> months</li>
            </ol>
            <p>DB</p>
      </div>
    <% end %>

    <!-- PATH PLANNER -->
      <h1>Path planner</h1>
      <p>Here you can manage the tasks you need to complete on your journey.</p>

    <!-- RECOMMENDED TASKS -->
        <% if @current_user.user_type == "user"%>
          <h2>Recommended tasks</h2>
          <p>These are recommended tasks for your path.</p>

          <% @recommended_tasks.each do |recommended_task| %>
            <div class="planner-row">
              <strong><%= recommended_task.task_name%></strong>
              <%= link_to add_to_checklist_path(recommended_task), method: :patch do %>
                <i class="fa fa-plus"></i>
              <% end %>
            </div>
          <% end %>
        <% end %>
      <!-- </div> -->

      <!-- MY TASKS LIST -->
      <h2>Task list</h2>
        <% if @user_tasks.empty? %>
          <p>Create a task you need to complete on your journey. High priority tasks will create reminders on your dashboard.</p>

        <% else %>
        <!-- TASK TABLE HEADER -->
        <div class="planner-row">
          <p>Status</p>
          <p>Description</p>
          <p>Priority</p>
          <p>Edit</p>
          <p>Delete</p>
        </div>
        <!-- HIGH PRIORITY TASKS -->
        <% @high_priority_tasks.each do |task| %>
          <div class="planner-container">
            <div class="planner-row">
              <!-- TASK CHECKBOX -->
              <%= link_to mark_task_path(task), method: :patch do %>
                <% if task.task_status %>
                    <i class="fa fa-check-square"></i>
                  <% else %>
                    <i class="fa fa-square"></i>
                  <% end %>
                <% end %>
              <!-- TASK NAME -->
              <strong><%= task.task_name%></strong>
              <!-- TASK PRIORITY -->
              <p><%= task.priority %></p>
              <!-- TASK EDIT -->
              <%= link_to edit_task_path(task) do %><i class="fa fa-edit"></i><% end %>
              <!-- TASK DELETE -->
              <%= link_to task_path(task), method: :delete, data: { confirm: "Are you sure?" } do %>
                <i class="fa fa-trash"></i>
              <% end %>
            </div>
          </div>
        <% end %>
        <!-- MEDIUM PRIORITY TASKS -->
        <% @medium_priority_tasks.each do |task| %>
            <div class="planner-row">
            <!-- TASK CHECKBOX -->
            <%= link_to mark_task_path(task), method: :patch do %>
              <% if task.task_status %>
                  <i class="fa fa-check-square"></i>
                <% else %>
                  <i class="fa fa-square"></i>
                <% end %>
              <% end %>
            <!-- TASK NAME -->
            <strong><%= task.task_name%></strong>
            <!-- TASK PRIORITY -->
            <p><%= task.priority %></p>
            <!-- TASK EDIT -->
            <%= link_to edit_task_path(task) do %><i class="fa fa-edit"></i><% end %>
            <!-- TASK DELETE -->
            <%= link_to task_path(task), method: :delete, data: { confirm: "Are you sure?" } do %>
              <i class="fa fa-trash"></i>
            <% end %>
          </div>
        <% end %>

          <% @low_priority_tasks.each do |task| %>
            <div class="planner-row">
            <!-- TASK CHECKBOX -->
            <%= link_to mark_task_path(task), method: :patch do %>
              <% if task.task_status %>
                  <i class="fa fa-check-square"></i>
                <% else %>
                  <i class="fa fa-square"></i>
                <% end %>
              <% end %>
            <!-- TASK NAME -->
            <strong><%= task.task_name%></strong>
            <!-- TASK PRIORITY -->
            <p><%= task.priority %></p>
            <!-- TASK EDIT -->
            <%= link_to edit_task_path(task) do %><i class="fa fa-edit"></i><% end %>
            <!-- TASK DELETE -->
            <%= link_to task_path(task), method: :delete, data: { confirm: "Are you sure?" } do %>
              <i class="fa fa-trash"></i>
            <% end %>
          </div>
        <% end %>
        <% end %>
        <div class="appointment-actions">
          <button class="btn-appointment"> <%= link_to new_task_path  do %>Add a new task<% end %> </button>
        </div>
      </div>
    </div>
  </div>
